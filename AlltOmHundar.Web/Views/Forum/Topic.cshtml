@model IEnumerable<AlltOmHundar.Core.Models.Post>

@{
    ViewData["Title"] = "Tråd";
    var topic = ViewBag.Topic;
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">@topic?.Title</h3>
    <a class="btn btn-success"
       asp-controller="Post" asp-action="CreatePost"
       asp-route-topicId="@topic.Id">
        Nytt inlägg (med bild)
    </a>
</div>

@if (!string.IsNullOrWhiteSpace(topic?.Description))
{
    <p class="text-muted">@topic.Description</p>
}

@if (TempData["SuccessMessage"] is string ok)
{
    <div class="alert alert-success">@ok</div>
}
@if (TempData["ErrorMessage"] is string err)
{
    <div class="alert alert-danger">@err</div>
}

@foreach (var post in Model ?? Enumerable.Empty<AlltOmHundar.Core.Models.Post>())
{
    <div class="card mb-3">
        <div class="card-body">
            <div class="small text-muted">
                @post.CreatedAt.ToLocalTime():g — @post.User?.Username
            </div>
            <div class="mt-2">@post.Content</div>

            @if (!string.IsNullOrEmpty(post.ImageUrl))
            {
                <div class="mt-2">
                    <img src="@post.ImageUrl" alt="Postbild" class="img-fluid rounded"
                         style="max-height:380px;object-fit:contain;" />
                </div>
            }
        </div>
    </div>
}
